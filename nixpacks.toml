[phases.setup]
# ติดตั้ง Node.js 20, Python 3.9, Tesseract OCR, และ C++ libraries
# NumPy, OpenCV, Pillow จาก pip (ต้องการ libstdc++.so.6)
nixPkgs = [
  'nodejs_20',
  'python39',
  'python39Packages.pip',
  'tesseract',
  'zlib',
  'stdenv.cc.cc.lib'
]
aptPkgs = ['libgl1', 'libglib2.0-0']

[phases.install]
# ติดตั้ง Node.js dependencies ใน petizo folder
cmds = ['cd petizo && npm install']

[phases.build]
# ไม่ติดตั้ง Python packages ตอน build (ทำให้ image ใหญ่เกิน 13GB > 4GB limit)
# จะติดตั้งตอน runtime ใน Volume แทน (ครั้งเดียว แล้วเก็บใน Volume)
cmds = []

[start]
# เริ่ม server จากโฟลเดอร์ petizo - start.sh จะติดตั้ง Python packages ถ้ายังไม่มี
cmd = 'cd petizo && chmod +x start.sh && ./start.sh'
